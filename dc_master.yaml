version: "3.6"

volumes:
    log:
        name: <GLOBAL_PREFIX>log
        driver_opts:
            type: none
            device: <CURDIR>/vol/log
            o: bind
    postgres:
        name: <GLOBAL_PREFIX>postgres
        driver_opts:
            type: none
            device: <CURDIR>/vol/postgres
            o: bind
    rdmoapp:
        name: <GLOBAL_PREFIX>rdmoapp
        driver_opts:
            type: none
            device: <CURDIR>/vol/rdmo-app
            o: bind
    ve:
        name: <GLOBAL_PREFIX>ve
        driver_opts:
            type: none
            device: <CURDIR>/vol/ve
            o: bind

services:
    apache:
        build:
            context: ./apache
        container_name: <GLOBAL_PREFIX>apache
        ports:
            - "<FINALLY_EXPOSED_PORT>:80"
        volumes:
            - log:/vol/log
            - rdmoapp:/vol/rdmo-app
            - ve:/vol/ve
        env_file:
            - variables.env
        depends_on:
            - rdmo

    postgres:
        build:
            context: ./postgres
        container_name: <GLOBAL_PREFIX>postgres
        volumes:
            - postgres:/var/lib/postgresql/data
        env_file:
            - variables.env

    rdmo:
        build:
            context: ./rdmo
        container_name: <GLOBAL_PREFIX>rdmo
        depends_on:
            - postgres
        volumes:
            - log:/vol/log
            - rdmoapp:/vol/rdmo-app
            - ve:/vol/ve
        env_file:
            - variables.env
